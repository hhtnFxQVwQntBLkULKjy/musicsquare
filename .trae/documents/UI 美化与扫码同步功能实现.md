# UI 极致美化与扫码同步/头像上传计划

收到。我们将专注于 **QQ 音乐** 和 **网易云音乐** 的完美扫码体验，以及**头像上传**功能，同时对**登录/注册/退出/歌单操作**的 UI 进行极致美化（MoonTV 风格）。

## 1. 后端功能升级 (`backend/worker.js`)

### 1.1 扫码登录 API
实现两组接口：
*   `/api/qr/create`: 接收 `platform=netease|qq`，返回二维码图片 Base64 和 `key/qrsig`。
*   `/api/qr/check`: 接收 `key` 和 `platform`，返回登录状态和 Cookie。
*   **登录成功处理**: 获取 Cookie 后，**自动**调用 Meting 或官方接口拉取用户歌单，存入 `playlists` 表，实现“扫码即同步”。

### 1.2 头像上传 API
*   `/api/user/avatar`: 接收 Base64 图片字符串，更新 `users` 表。

## 2. 前端 UI 重构 (MoonTV 风格)

### 2.1 登录/注册页 (`login.html` & CSS)
*   **Toast 提示**: 替代 `alert`，设计顶部悬浮的彩色提示条（成功绿色，失败红色）。
*   **注册成功模态框**: 精致的居中弹窗，带有动画图标和渐变按钮，点击后自动切换到登录模式填入账号。

### 2.2 主界面交互
*   **头像菜单**: 
    *   点击头像 -> 下拉菜单：[更换头像] [同步平台] [修改昵称] [退出登录]。
    *   **更换头像**: 点击触发文件选择，前端压缩为 200px Base64 后上传。
*   **同步弹窗**: 
    *   双列布局：左侧 [网易云] 右侧 [QQ音乐]。
    *   点击即显示二维码，下方显示“扫描成功/已确认”状态。
*   **退出登录**: 
    *   二次确认弹窗，毛玻璃背景，按钮“确认退出” (红色) / “取消” (灰色)。

### 2.3 歌单逻辑修复
*   **新建歌单**: 确保创建后立即重绘侧边栏，并更新内存中的 `playlists` 缓存，解决“未建立歌单”的报错。

## 3. 执行顺序

1.  **Backend**: 更新 `worker.js` (添加 QR 接口和 Avatar 接口)。
2.  **CSS**: 添加 Toast, Modal, Dropdown 的样式。
3.  **JS**: 
    *   封装 `showToast()` 和 `showModal()`。
    *   实现头像上传和扫码轮询逻辑。
    *   修复歌单同步缓存问题。
4.  **Verification**: 启动服务验证。
