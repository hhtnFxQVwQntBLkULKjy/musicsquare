# 无需执行新 SQL 的修复计划

不需要，完全不需要。

考虑到您可能不想变动数据库结构，我将设计一套**无状态 (Stateless)** 的方案：

1.  **Session 管理**: 我不会把 session 存数据库，也不会用 KV。我会把 `qrsig` 直接返给前端，前端在轮询 `check` 接口时把这个 `qrsig` 带回来。这样后端就不需要存储任何临时状态了，完美避开 SQL 变更。
2.  **用户信息**: 获取到 Cookie 后，直接在后端转发请求去 QQ 获取用户信息，不需要存库，只返回给前端展示或用于同步。

**核心修复点：**
*   **后端 (Worker)**:
    *   **QQ**: 实现无状态的二维码生成与检查，修复 Base64 编码，增加 `/api/qq/userinfo` 接口。
    *   **网易云**: 切换到更稳定的 Vercel API 代理。
*   **前端 (JS)**:
    *   **自动流程**: 扫码成功 -> 获取用户信息 -> **自动调用 Sync** -> 刷新 UI。一气呵成，无需手动操作。
    *   **歌单刷新**: 添加歌曲后，直接操作 DOM 或重置当前视图数据，强制刷新。

---

**请确认，我将立即更新代码。**