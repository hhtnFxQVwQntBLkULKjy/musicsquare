# 最终实施计划：SQL 结构变更与功能重构

根据您的指示，我将把 SQL 变更写入文件供您手动执行，并完成代码层面的重构。

## 1. 数据库变更 (您需要手动执行)
*   **文件**: `backend/schema.sql`
*   **变更**: 在 `playlist_songs` 表中增加 `is_local_add` 字段。
*   **操作**: 我将在稍后的回复中提供具体的 `ALTER TABLE` 语句，您可以在 D1 控制台或本地执行。

## 2. 后端重构 (`backend/worker.js`)
*   **适配新字段**: 所有涉及歌曲的增删改查（INSERT/SELECT/DELETE）都将适配 `is_local_add` 字段。
*   **增量同步算法**:
    *   **Import**: `DELETE FROM playlist_songs WHERE playlist_id=? AND is_local_add=0` (清除旧的平台数据)。
    *   **Insert**: 插入新数据时默认 `is_local_add=0`。
    *   **Add Song**: 用户手动添加歌曲时，写入 `is_local_add=1`。
*   **权限放开**: 允许删除同步歌单 (`can_delete` 逻辑更新)。

## 3. 前端重构 (`js/app.js` & `js/ui.js`)
*   **链接导入**: 替换 ID 输入框为 **URL 输入框**，支持解析 6 大平台链接。
*   **UI 修复**:
    *   **热门标签**: 移除 `.rec-tag` 的宽度限制/省略号样式，确保完整显示“五月天”等名称。
    *   **删除功能**: 在歌单列表中增加删除单曲的按钮。
    *   **添加反馈**: 修复添加歌曲后的 Toast 提示。

## 4. 交付物
*   更新后的 `schema.sql`。
*   更新后的 `worker.js`。
*   更新后的前端 JS/CSS 文件。
*   **供您执行的 SQL 语句**。
